from google import genai
from pocketflow import Node, Flow

def call_gemini(client, history):
    return genai.models.generate_content(
            model="gemini-2.5-flash", contents=f"{history}"
            ) 

class ChatBotNode(Node):
    def prep(self, shared):
        user_message = input("You: ")    
        if "messages" not in shared:
            shared["messages"] = [shared["system_prompt"]] # list containing, the system prompt
        shared["messages"].append({"role": "user", "message": f"{user_message}"})

        return shared["messages"]
        
    def exec(self, shared_messages):
        return call_gemini(shared_messages)
        
        
    def post(self, shared, _, exec_res):
        shared["messages"].append({"role": "llm", "message": f"{exec_res}"})
        return "continue"

chatnode = ChatNode()
chatnode >> chatnode
flow = Flow(start=chatnode)

if __name__ == "__main__":
    # Then run
    flow.run(state_store)



